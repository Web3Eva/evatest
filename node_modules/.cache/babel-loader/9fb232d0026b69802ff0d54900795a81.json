{"ast":null,"code":"import _asyncToGenerator from\"C:/Users/Lahcen Laayouni/Documents/Eva/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/Lahcen Laayouni/Documents/Eva/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"C:\\\\Users\\\\Lahcen Laayouni\\\\Documents\\\\Eva\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import React from\"react\";import'./MessageInFeed.css';import{defaultImgs}from\"../defaultimgs\";import{Icon}from\"web3uikit\";import{useMoralis,useMoralisQuery}from\"react-moralis\";import{useEffect,useState}from\"react\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var MessageInFeed=function MessageInFeed(_ref){var profile=_ref.profile;var _useState=useState(),_useState2=_slicedToArray(_useState,2),MessageArr=_useState2[0],setMessageArr=_useState2[1];var _useMoralis=useMoralis(),Moralis=_useMoralis.Moralis,account=_useMoralis.account;var user=Moralis.User.current();function like(_x){return _like.apply(this,arguments);}function _like(){_like=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(id){var query,results,likebuttons;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:localStorage.setItem(\"id\",id);query=new Moralis.Query(\"Messages\");query.equalTo(\"objectId\",localStorage.getItem(\"id\"));_context2.next=5;return query.find();case 5:results=_context2.sent;likebuttons=results.map(function(e){var likevalue=e.attributes.likes;var likelist=e.attributes.likelist;var likelistsplit=likelist.split(\"§\");if(likelistsplit.includes(user.attributes.ethAddress)==false){likevalue+=1;likelistsplit.push(user.attributes.ethAddress);document.getElementById(\"icon\"+localStorage.getItem(\"id\")).className=\"yellow\";e.set(\"likes\",likevalue);e.set(\"likelist\",likelistsplit.join(\"§\"));e.save();}else{likevalue-=1;var index=likelistsplit.indexOf(user.attributes.ethAddress);if(index>-1){likelistsplit.splice(index,1);}document.getElementById(\"icon\"+localStorage.getItem(\"id\")).className=\"white\";e.set(\"likes\",likevalue);e.set(\"likelist\",likelistsplit.join(\"§\"));e.save();}document.getElementById(localStorage.getItem(\"id\")).innerText=likevalue;});case 7:case\"end\":return _context2.stop();}}},_callee2);}));return _like.apply(this,arguments);}useEffect(function(){function getMessages(){return _getMessages.apply(this,arguments);}function _getMessages(){_getMessages=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var queriy,messageget,Messages,query,results;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;queriy=new Moralis.Query('Messages');_context.next=4;return queriy.subscribe();case 4:messageget=_context.sent;messageget.on('create',function(object){getMessages();});Messages=Moralis.Object.extend(\"Messages\");query=new Moralis.Query(Messages);if(profile){query.equalTo(\"senderAcc\",account);}_context.next=11;return query.find();case 11:results=_context.sent;setMessageArr(results);_context.next=18;break;case 15:_context.prev=15;_context.t0=_context[\"catch\"](0);console.error(_context.t0);case 18:case\"end\":return _context.stop();}}},_callee,null,[[0,15]]);}));return _getMessages.apply(this,arguments);}getMessages();},[profile]);return/*#__PURE__*/_jsx(_Fragment,{children:MessageArr===null||MessageArr===void 0?void 0:MessageArr.map(function(e){return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"feedEva\",children:[/*#__PURE__*/_jsx(\"img\",{src:e.attributes.senderPfp?e.attributes.senderPfp:defaultImgs[0],className:\"profilePic\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"completeEva\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"who\",children:[e.attributes.senderUsername.slice(0,6),/*#__PURE__*/_jsx(\"div\",{className:\"accWhen\",children:\"\".concat(e.attributes.senderAcc.slice(0,4),\"...\").concat(e.attributes.senderAcc.slice(38),\" \\xB7 \\n                        \").concat(e.attributes.createdAt.toLocaleString('en-us',{month:'short'}),\"  \\n                        \").concat(e.attributes.createdAt.toLocaleString('en-us',{day:'numeric'}),\"\\n                        \")})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"evaContent\",children:[e.attributes.messageTxt,e.attributes.messageImg&&/*#__PURE__*/_jsx(\"img\",{src:e.attributes.messageImg,className:\"evaImg\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"interactions\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"interactionNums\",children:/*#__PURE__*/_jsx(Icon,{fill:\"#f5f5f5\",size:20,svg:\"messageCircle\"})}),/*#__PURE__*/_jsxs(\"div\",{onClick:function onClick(){return like(e.id);},className:\"interactionNums\",children:[/*#__PURE__*/_jsx(Icon,{id:\"icon\"+e.id,fill:\"currentColor\",stroke:\"currentColor\",size:20,svg:\"star\"}),/*#__PURE__*/_jsx(\"p\",{style:{margin:0},id:e.id,children:e.attributes.likes})]}),/*#__PURE__*/_jsx(\"div\",{className:\"interactionNums\",children:/*#__PURE__*/_jsx(Icon,{fill:\"#f5f5f5\",size:20,svg:\"matic\"})})]})]})]})});}).reverse()});};export default MessageInFeed;","map":{"version":3,"names":["React","defaultImgs","Icon","useMoralis","useMoralisQuery","useEffect","useState","MessageInFeed","profile","MessageArr","setMessageArr","Moralis","account","user","User","current","like","id","localStorage","setItem","query","Query","equalTo","getItem","find","results","likebuttons","map","e","likevalue","attributes","likes","likelist","likelistsplit","split","includes","ethAddress","push","document","getElementById","className","set","join","save","index","indexOf","splice","innerText","getMessages","queriy","subscribe","messageget","on","object","Messages","Object","extend","console","error","senderPfp","senderUsername","slice","senderAcc","createdAt","toLocaleString","month","day","messageTxt","messageImg","margin","reverse"],"sources":["C:/Users/Lahcen Laayouni/Documents/Eva/src/components/MessageInFeed.js"],"sourcesContent":["import React from \"react\";\nimport './MessageInFeed.css';\nimport {defaultImgs} from \"../defaultimgs\"\nimport {Icon} from \"web3uikit\"\nimport { useMoralis, useMoralisQuery } from \"react-moralis\";\nimport { useEffect, useState } from \"react\";\nconst MessageInFeed = ({profile}) => {\n  const [MessageArr, setMessageArr] = useState();\n  const {Moralis, account} = useMoralis();\n  const user = Moralis.User.current();\n  \n  \n   async function like(id){\n    localStorage.setItem(\"id\", id)\n        const query = new Moralis.Query(\"Messages\")\n        query.equalTo(\"objectId\",localStorage.getItem(\"id\"))\n        const results = await query.find()\n        let likebuttons = results.map((e) =>{\n          let likevalue = e.attributes.likes\n          let likelist = e.attributes.likelist\n          let likelistsplit = likelist.split(\"§\")\n          if(likelistsplit.includes(user.attributes.ethAddress) == false){\n            likevalue += 1\n            likelistsplit.push(user.attributes.ethAddress)\n            document.getElementById(\"icon\" + localStorage.getItem(\"id\")).className = \"yellow\"\n            e.set(\"likes\", likevalue)\n            e.set(\"likelist\", likelistsplit.join(\"§\"))\n            e.save()\n          }else{\n            likevalue -= 1\n            const index = likelistsplit.indexOf(user.attributes.ethAddress);\n            if (index > -1) {\n              likelistsplit.splice(index, 1);\n            }\n            document.getElementById(\"icon\" + localStorage.getItem(\"id\")).className = \"white\"\n            e.set(\"likes\", likevalue)\n            e.set(\"likelist\", likelistsplit.join(\"§\"))\n            e.save()\n            \n          }\n          \n          \n          document.getElementById(localStorage.getItem(\"id\")).innerText = likevalue\n          \n          \n          \n\n       \n        \n      \n      \n    });\n   \n  }\n  useEffect(() => {\n    \n    async function getMessages() {\n      try {\n        let queriy = new Moralis.Query('Messages');\n        let messageget = await queriy.subscribe();\n        messageget.on('create', (object) => {\n          getMessages()\n        });\n        const Messages = Moralis.Object.extend(\"Messages\");\n        const query = new Moralis.Query(Messages);\n        if (profile) {\n          query.equalTo(\"senderAcc\", account);\n        }\n        const results = await query.find();\n        setMessageArr(results);\n      } catch (error) {\n        console.error(error);\n      }\n    }\n    getMessages();\n  }, [profile]);\n  \n  return (\n    <>\n    {MessageArr?.map((e) => {\n        return (\n          <>\n            <div className=\"feedEva\">\n              <img src={e.attributes.senderPfp ? e.attributes.senderPfp : defaultImgs[0]} className=\"profilePic\"></img>\n              <div className=\"completeEva\">\n                <div className=\"who\">\n                {e.attributes.senderUsername.slice(0, 6)}\n                  <div className=\"accWhen\">{\n                        `${e.attributes.senderAcc.slice(0, 4)}...${e.attributes.senderAcc.slice(38)} · \n                        ${e.attributes.createdAt.toLocaleString('en-us', { month: 'short' })}  \n                        ${e.attributes.createdAt.toLocaleString('en-us', { day: 'numeric' })}\n                        `  \n                      }\n                      </div>\n                </div>\n                <div className=\"evaContent\">\n                {e.attributes.messageTxt}\n                {e.attributes.messageImg && (\n                        <img\n                          src={e.attributes.messageImg}\n                          className=\"evaImg\"\n                        ></img>\n                      )}\n                </div>\n                <div className=\"interactions\">\n                  <div className=\"interactionNums\">\n                    <Icon fill=\"#f5f5f5\" size={20} svg=\"messageCircle\" />\n                  </div>\n                  <div  onClick={() => like(e.id)} className=\"interactionNums\">\n                    <Icon id={\"icon\" + e.id} fill=\"currentColor\" stroke=\"currentColor\" size={20} svg=\"star\" /><p style={{margin:0}} id={e.id}>{e.attributes.likes}</p>\n                  </div>\n                  <div className=\"interactionNums\">\n                    <Icon fill=\"#f5f5f5\" size={20} svg=\"matic\" />\n                  </div>\n                </div>\n              </div>\n            </div>\n          </>\n        );\n      }).reverse()}\n    </>\n  );\n};\nexport default MessageInFeed;\n\n"],"mappings":"gYAAA,MAAOA,MAAP,KAAkB,OAAlB,CACA,MAAO,qBAAP,CACA,OAAQC,WAAR,KAA0B,gBAA1B,CACA,OAAQC,IAAR,KAAmB,WAAnB,CACA,OAASC,UAAT,CAAqBC,eAArB,KAA4C,eAA5C,CACA,OAASC,SAAT,CAAoBC,QAApB,KAAoC,OAApC,C,6IACA,GAAMC,cAAa,CAAG,QAAhBA,cAAgB,MAAe,IAAbC,QAAa,MAAbA,OAAa,CACnC,cAAoCF,QAAQ,EAA5C,wCAAOG,UAAP,eAAmBC,aAAnB,eACA,gBAA2BP,UAAU,EAArC,CAAOQ,OAAP,aAAOA,OAAP,CAAgBC,OAAhB,aAAgBA,OAAhB,CACA,GAAMC,KAAI,CAAGF,OAAO,CAACG,IAAR,CAAaC,OAAb,EAAb,CAHmC,QAMnBC,KANmB,wHAMlC,kBAAoBC,EAApB,oJACCC,YAAY,CAACC,OAAb,CAAqB,IAArB,CAA2BF,EAA3B,EACUG,KAFX,CAEmB,GAAIT,QAAO,CAACU,KAAZ,CAAkB,UAAlB,CAFnB,CAGKD,KAAK,CAACE,OAAN,CAAc,UAAd,CAAyBJ,YAAY,CAACK,OAAb,CAAqB,IAArB,CAAzB,EAHL,uBAI2BH,MAAK,CAACI,IAAN,EAJ3B,QAIWC,OAJX,gBAKSC,WALT,CAKuBD,OAAO,CAACE,GAAR,CAAY,SAACC,CAAD,CAAM,CAClC,GAAIC,UAAS,CAAGD,CAAC,CAACE,UAAF,CAAaC,KAA7B,CACA,GAAIC,SAAQ,CAAGJ,CAAC,CAACE,UAAF,CAAaE,QAA5B,CACA,GAAIC,cAAa,CAAGD,QAAQ,CAACE,KAAT,CAAe,GAAf,CAApB,CACA,GAAGD,aAAa,CAACE,QAAd,CAAuBtB,IAAI,CAACiB,UAAL,CAAgBM,UAAvC,GAAsD,KAAzD,CAA+D,CAC7DP,SAAS,EAAI,CAAb,CACAI,aAAa,CAACI,IAAd,CAAmBxB,IAAI,CAACiB,UAAL,CAAgBM,UAAnC,EACAE,QAAQ,CAACC,cAAT,CAAwB,OAASrB,YAAY,CAACK,OAAb,CAAqB,IAArB,CAAjC,EAA6DiB,SAA7D,CAAyE,QAAzE,CACAZ,CAAC,CAACa,GAAF,CAAM,OAAN,CAAeZ,SAAf,EACAD,CAAC,CAACa,GAAF,CAAM,UAAN,CAAkBR,aAAa,CAACS,IAAd,CAAmB,GAAnB,CAAlB,EACAd,CAAC,CAACe,IAAF,GACD,CAPD,IAOK,CACHd,SAAS,EAAI,CAAb,CACA,GAAMe,MAAK,CAAGX,aAAa,CAACY,OAAd,CAAsBhC,IAAI,CAACiB,UAAL,CAAgBM,UAAtC,CAAd,CACA,GAAIQ,KAAK,CAAG,CAAC,CAAb,CAAgB,CACdX,aAAa,CAACa,MAAd,CAAqBF,KAArB,CAA4B,CAA5B,EACD,CACDN,QAAQ,CAACC,cAAT,CAAwB,OAASrB,YAAY,CAACK,OAAb,CAAqB,IAArB,CAAjC,EAA6DiB,SAA7D,CAAyE,OAAzE,CACAZ,CAAC,CAACa,GAAF,CAAM,OAAN,CAAeZ,SAAf,EACAD,CAAC,CAACa,GAAF,CAAM,UAAN,CAAkBR,aAAa,CAACS,IAAd,CAAmB,GAAnB,CAAlB,EACAd,CAAC,CAACe,IAAF,GAED,CAGDL,QAAQ,CAACC,cAAT,CAAwBrB,YAAY,CAACK,OAAb,CAAqB,IAArB,CAAxB,EAAoDwB,SAApD,CAAgElB,SAAhE,CASL,CAlCqB,CALvB,yDANkC,uCAgDnCxB,SAAS,CAAC,UAAM,SAEC2C,YAFD,2IAEd,gMAEQC,MAFR,CAEiB,GAAItC,QAAO,CAACU,KAAZ,CAAkB,UAAlB,CAFjB,uBAG2B4B,OAAM,CAACC,SAAP,EAH3B,QAGQC,UAHR,eAIIA,UAAU,CAACC,EAAX,CAAc,QAAd,CAAwB,SAACC,MAAD,CAAY,CAClCL,WAAW,GACZ,CAFD,EAGMM,QAPV,CAOqB3C,OAAO,CAAC4C,MAAR,CAAeC,MAAf,CAAsB,UAAtB,CAPrB,CAQUpC,KARV,CAQkB,GAAIT,QAAO,CAACU,KAAZ,CAAkBiC,QAAlB,CARlB,CASI,GAAI9C,OAAJ,CAAa,CACXY,KAAK,CAACE,OAAN,CAAc,WAAd,CAA2BV,OAA3B,EACD,CAXL,uBAY0BQ,MAAK,CAACI,IAAN,EAZ1B,SAYUC,OAZV,eAaIf,aAAa,CAACe,OAAD,CAAb,CAbJ,iFAeIgC,OAAO,CAACC,KAAR,cAfJ,qEAFc,8CAoBdV,WAAW,GACZ,CArBQ,CAqBN,CAACxC,OAAD,CArBM,CAAT,CAuBA,mBACE,yBACCC,UADD,SACCA,UADD,iBACCA,UAAU,CAAEkB,GAAZ,CAAgB,SAACC,CAAD,CAAO,CACpB,mBACE,sCACE,aAAK,SAAS,CAAC,SAAf,wBACE,YAAK,GAAG,CAAEA,CAAC,CAACE,UAAF,CAAa6B,SAAb,CAAyB/B,CAAC,CAACE,UAAF,CAAa6B,SAAtC,CAAkD1D,WAAW,CAAC,CAAD,CAAvE,CAA4E,SAAS,CAAC,YAAtF,EADF,cAEE,aAAK,SAAS,CAAC,aAAf,wBACE,aAAK,SAAS,CAAC,KAAf,WACC2B,CAAC,CAACE,UAAF,CAAa8B,cAAb,CAA4BC,KAA5B,CAAkC,CAAlC,CAAqC,CAArC,CADD,cAEE,YAAK,SAAS,CAAC,SAAf,oBACSjC,CAAC,CAACE,UAAF,CAAagC,SAAb,CAAuBD,KAAvB,CAA6B,CAA7B,CAAgC,CAAhC,CADT,eACiDjC,CAAC,CAACE,UAAF,CAAagC,SAAb,CAAuBD,KAAvB,CAA6B,EAA7B,CADjD,4CAEQjC,CAAC,CAACE,UAAF,CAAaiC,SAAb,CAAuBC,cAAvB,CAAsC,OAAtC,CAA+C,CAAEC,KAAK,CAAE,OAAT,CAA/C,CAFR,wCAGQrC,CAAC,CAACE,UAAF,CAAaiC,SAAb,CAAuBC,cAAvB,CAAsC,OAAtC,CAA+C,CAAEE,GAAG,CAAE,SAAP,CAA/C,CAHR,gCAFF,GADF,cAWE,aAAK,SAAS,CAAC,YAAf,WACCtC,CAAC,CAACE,UAAF,CAAaqC,UADd,CAECvC,CAAC,CAACE,UAAF,CAAasC,UAAb,eACO,YACE,GAAG,CAAExC,CAAC,CAACE,UAAF,CAAasC,UADpB,CAEE,SAAS,CAAC,QAFZ,EAHR,GAXF,cAoBE,aAAK,SAAS,CAAC,cAAf,wBACE,YAAK,SAAS,CAAC,iBAAf,uBACE,KAAC,IAAD,EAAM,IAAI,CAAC,SAAX,CAAqB,IAAI,CAAE,EAA3B,CAA+B,GAAG,CAAC,eAAnC,EADF,EADF,cAIE,aAAM,OAAO,CAAE,yBAAMpD,KAAI,CAACY,CAAC,CAACX,EAAH,CAAV,EAAf,CAAiC,SAAS,CAAC,iBAA3C,wBACE,KAAC,IAAD,EAAM,EAAE,CAAE,OAASW,CAAC,CAACX,EAArB,CAAyB,IAAI,CAAC,cAA9B,CAA6C,MAAM,CAAC,cAApD,CAAmE,IAAI,CAAE,EAAzE,CAA6E,GAAG,CAAC,MAAjF,EADF,cAC4F,UAAG,KAAK,CAAE,CAACoD,MAAM,CAAC,CAAR,CAAV,CAAsB,EAAE,CAAEzC,CAAC,CAACX,EAA5B,UAAiCW,CAAC,CAACE,UAAF,CAAaC,KAA9C,EAD5F,GAJF,cAOE,YAAK,SAAS,CAAC,iBAAf,uBACE,KAAC,IAAD,EAAM,IAAI,CAAC,SAAX,CAAqB,IAAI,CAAE,EAA3B,CAA+B,GAAG,CAAC,OAAnC,EADF,EAPF,GApBF,GAFF,GADF,EADF,CAuCD,CAxCF,EAwCIuC,OAxCJ,EADD,EADF,CA6CD,CApHD,CAqHA,cAAe/D,cAAf"},"metadata":{},"sourceType":"module"}